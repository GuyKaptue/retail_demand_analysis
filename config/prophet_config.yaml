# =============================================================================
# PROPHET MODEL CONFIGURATION - COMPREHENSIVE EDITION
# =============================================================================
# This configuration file defines all relevant parameters for the Prophet
# forecasting model, including trend, seasonality, priors, changepoints,
# uncertainty intervals, and evaluation settings.
#
# Prophet Documentation:
# https://facebook.github.io/prophet/docs/quick_start.html
# =============================================================================

prophet:
  # ---------------------------------------------------------------------------
  # GROWTH MODEL
  # Options:
  #   - linear: Standard linear growth (default)
  #   - logistic: Saturating growth (requires 'cap' and optionally 'floor' 
  #               columns in the dataset)
  #   - flat: No trend component
  # ---------------------------------------------------------------------------
  growth: "linear"
  
  # ---------------------------------------------------------------------------
  # LOGISTIC GROWTH PARAMETERS (only used if growth='logistic')
  # ---------------------------------------------------------------------------
  cap: null  # Maximum carrying capacity (required for logistic growth)
  floor: null  # Minimum floor value (optional for logistic growth)
  
  # ---------------------------------------------------------------------------
  # SEASONALITY MODE
  # Options:
  #   - additive: Seasonality added to trend (default)
  #   - multiplicative: Seasonality multiplied by trend
  # ---------------------------------------------------------------------------
  seasonality_mode: "additive"
  
  # ---------------------------------------------------------------------------
  # BUILT-IN SEASONALITIES
  # Enable or disable Prophet's default seasonal components
  # Can be boolean (True/False) or dict with parameters
  # ---------------------------------------------------------------------------
  yearly_seasonality: 
    enabled: false
    fourier_order: 10  # Number of Fourier terms (higher = more flexible)
    prior_scale: 10.0  # Regularization strength
    mode: null  # Override global seasonality_mode if needed
    
  weekly_seasonality:
    enabled: true
    fourier_order: 3
    prior_scale: 10.0
    mode: null
    
  daily_seasonality:
    enabled: false
    fourier_order: 4
    prior_scale: 10.0
    mode: null
  
  # ---------------------------------------------------------------------------
  # CUSTOM SEASONALITIES
  # Add domain-specific seasonal patterns
  # Each seasonality requires:
  #   - name: unique identifier
  #   - period: period in days (e.g., 30.5 for monthly, 365.25 for yearly)
  #   - fourier_order: complexity of the pattern (higher = more flexible)
  #   - prior_scale: regularization (higher = more flexible)
  #   - mode: 'additive' or 'multiplicative' (optional, inherits from global)
  #   - condition_name: column name for conditional seasonality (optional)
  # ---------------------------------------------------------------------------
  custom_seasonalities:
    # Example: Monthly seasonality
    # - name: "monthly"
    #   period: 30.5
    #   fourier_order: 5
    #   prior_scale: 10.0
    #   mode: "additive"
    
    # Example: Quarterly seasonality
    # - name: "quarterly"
    #   period: 91.25
    #   fourier_order: 8
    #   prior_scale: 10.0
    
    # Example: Bi-weekly pattern
    # - name: "biweekly"
    #   period: 14
    #   fourier_order: 3
    #   prior_scale: 5.0
  
  # ---------------------------------------------------------------------------
  # REGRESSORS
  # Additional covariates to include in the model
  # Each regressor can have:
  #   - name: column name in the dataframe
  #   - prior_scale: regularization strength (optional)
  #   - standardize: whether to standardize the regressor (optional, default='auto')
  #   - mode: 'additive' or 'multiplicative' (optional)
  # ---------------------------------------------------------------------------
  regressors:
    # Example: Promotion indicator
    # - name: "onpromotion"
    #   prior_scale: 10.0
    #   standardize: "auto"
    #   mode: "additive"
    
    # Example: Temperature
    # - name: "temperature"
    #   prior_scale: 5.0
    #   standardize: true
  
  # ---------------------------------------------------------------------------
  # PRIOR SCALES
  # Control flexibility of trend, seasonality, and holiday effects
  # Higher values → more flexible model (more prone to overfitting)
  # Lower values → more regularization (more conservative)
  # ---------------------------------------------------------------------------
  changepoint_prior_scale: 0.05  # Trend flexibility (typical: 0.001-0.5)
  seasonality_prior_scale: 10.0  # Seasonality flexibility (typical: 0.01-10)
  holidays_prior_scale: 10.0     # Holiday effect flexibility (typical: 0.01-10)
  
  # ---------------------------------------------------------------------------
  # CHANGEPOINT CONFIGURATION
  # Changepoints are points where the trend rate is allowed to change
  # ---------------------------------------------------------------------------
  changepoint_range: 0.8  # Proportion of history where changepoints allowed (0-1)
  n_changepoints: 25      # Number of potential changepoints to consider
  
  # Manual changepoint specification (overrides automatic detection if provided)
  changepoints: null  # List of dates (e.g., ['2023-01-01', '2023-06-01'])
  
  # ---------------------------------------------------------------------------
  # UNCERTAINTY / INTERVALS
  # Control prediction interval estimation
  # ---------------------------------------------------------------------------
  interval_width: 0.95  # Width of uncertainty intervals (0-1), e.g., 0.95 = 95%
  
  # MCMC sampling for full Bayesian inference (slow but more accurate)
  mcmc_samples: 0  # Number of MCMC samples (0 = MAP estimation, >0 = full Bayes)
  
  # Uncertainty sample count for interval estimation
  uncertainty_samples: 1000  # Number of samples for uncertainty (typical: 1000)
  
  # ---------------------------------------------------------------------------
  # HOLIDAYS CONFIGURATION
  # Options:
  #   1. Built-in country holidays (e.g., 'US', 'UK', 'DE', 'FR', etc.)
  #   2. Custom holidays dataframe with columns ['ds', 'holiday']
  #      Optionally: 'lower_window', 'upper_window', 'prior_scale'
  # ---------------------------------------------------------------------------
  country_holidays: null  # ISO country code (e.g., 'DE' for Germany)
  
  # Custom holidays (will be set programmatically via DataFrame)
  holidays: null
  
  # Holiday window parameters (used if not specified in holidays DataFrame)
  holidays_lower_window: 0  # Days before holiday to include effect
  holidays_upper_window: 0  # Days after holiday to include effect
  
  # ---------------------------------------------------------------------------
  # ADVANCED PARAMETERS
  # ---------------------------------------------------------------------------
  # Stan backend parameters
  stan_backend: null  # 'CMDSTANPY' or 'PYSTAN' (null = auto-detect)
  
  # Scaling options
  scaling: "absmax"  # 'absmax', 'minmax', or None
  
  # Training algorithm
  fit_algorithm: "LBFGS"  # Optimization algorithm for Stan
  
  # ---------------------------------------------------------------------------
  # CROSS-VALIDATION PARAMETERS
  # Used for model validation and hyperparameter tuning
  # ---------------------------------------------------------------------------
  cross_validation:
    initial: "730 days"  # Initial training period (e.g., '730 days', '2 years')
    period: "180 days"   # Spacing between cutoff dates
    horizon: "90 days"   # Forecast horizon for each fold
    parallel: "processes"  # 'processes', 'threads', or null
  
  # ---------------------------------------------------------------------------
  # OUTLIER HANDLING
  # ---------------------------------------------------------------------------
  outlier_detection:
    enabled: false
    threshold: 3.0  # Number of standard deviations for outlier detection
    method: "zscore"  # 'zscore' or 'iqr'

# =============================================================================
# EVALUATION CONFIGURATION
# =============================================================================
evaluation:
  # ---------------------------------------------------------------------------
  # PRIMARY METRIC
  # Used for model selection and comparison
  # Options: rmse, mae, mape, smape, mase, r2, mdape, rmsle
  # ---------------------------------------------------------------------------
  metric: "rmse"
  
  # ---------------------------------------------------------------------------
  # METRICS TO COMPUTE
  # List of all metrics to calculate during evaluation
  # ---------------------------------------------------------------------------
  metrics:
    - "mae"       # Mean Absolute Error
    - "mse"       # Mean Squared Error
    - "rmse"      # Root Mean Squared Error
    - "rmsle"     # Root Mean Squared Logarithmic Error
    - "mape"      # Mean Absolute Percentage Error
    - "smape"     # Symmetric Mean Absolute Percentage Error
    - "mdape"     # Median Absolute Percentage Error
    - "mase"      # Mean Absolute Scaled Error
    - "rmsse"     # Root Mean Squared Scaled Error
    - "rae"       # Relative Absolute Error
    - "rse"       # Relative Squared Error
    - "mfe"       # Mean Forecast Error (bias)
    - "r2"        # R-squared Score
    - "adj_r2"    # Adjusted R-squared
  
  # ---------------------------------------------------------------------------
  # DIAGNOSTICS
  # Statistical tests and residual analysis
  # ---------------------------------------------------------------------------
  compute_diagnostics: true
  
  diagnostics:
    # Autocorrelation analysis
    acf_lags: 40
    pacf_lags: 40
    
    # Statistical tests
    ljung_box_lags: [10, 20, 30]  # Lags for Ljung-Box test
    adf_test: true                 # Augmented Dickey-Fuller test
    kpss_test: true                # Kwiatkowski-Phillips-Schmidt-Shin test
    
    # Normality tests
    shapiro_test: true             # Shapiro-Wilk test
    jarque_bera_test: true         # Jarque-Bera test
    
    # Heteroscedasticity tests
    durbin_watson: true            # Durbin-Watson statistic
  
  # ---------------------------------------------------------------------------
  # CONFIDENCE INTERVALS
  # ---------------------------------------------------------------------------
  confidence_level: 0.95  # Confidence level for prediction intervals
  
  # ---------------------------------------------------------------------------
  # COMPONENT ANALYSIS
  # Analyze individual Prophet components (trend, seasonality, holidays)
  # ---------------------------------------------------------------------------
  analyze_components: true
  
  # ---------------------------------------------------------------------------
  # CROSS-VALIDATION EVALUATION
  # Evaluate model using time series cross-validation
  # ---------------------------------------------------------------------------
  perform_cv: false  # Set to true to enable cross-validation during evaluation
  
  # ---------------------------------------------------------------------------
  # VISUALIZATION OPTIONS
  # Control which plots to generate during evaluation
  # ---------------------------------------------------------------------------
  visualizations:
    forecast_plot: true
    components_plot: true
    residuals_plot: true
    diagnostics_plot: true
    comparison_plot: true

# =============================================================================
# HYPERPARAMETER TUNING CONFIGURATION
# =============================================================================
hyperparameter_tuning:
  enabled: false
  
  # Search space for hyperparameters
  param_grid:
    changepoint_prior_scale: [0.001, 0.01, 0.05, 0.1, 0.5]
    seasonality_prior_scale: [0.01, 0.1, 1.0, 10.0]
    holidays_prior_scale: [0.01, 0.1, 1.0, 10.0]
    seasonality_mode: ["additive", "multiplicative"]
  
  # Tuning method
  method: "grid_search"  # 'grid_search', 'random_search', or 'bayesian'
  
  # Cross-validation settings for tuning
  cv_horizon: "30 days"
  cv_initial: "365 days"
  cv_period: "90 days"
  
  # Number of iterations (for random/bayesian search)
  n_iter: 10
  
  # Scoring metric
  scoring: "rmse"

# =============================================================================
# LOGGING AND MLFLOW CONFIGURATION
# =============================================================================
logging:
  # MLflow tracking
  use_mlflow: true
  experiment_name: "Prophet_Forecasting"
  
  # Logging level
  verbosity: "INFO"  # 'DEBUG', 'INFO', 'WARNING', 'ERROR'
  
  # Save artifacts
  save_model: true
  save_predictions: true
  save_components: true
  save_diagnostics: true
  
  # Tags for MLflow runs
  default_tags:
    model_type: "prophet"
    framework: "facebook_prophet"
    task: "time_series_forecasting"